import React, {Component} from 'react';
import {connect} from 'react-redux';
import {withRouter, Link} from 'react-router-dom';
import {SubmissionError} from 'redux-form';

import {isFailure, isLoading, isSuccess} from 'actions';
import {LOGIN} from 'constants/user'
import {postPattern} from 'services/sendAccount';
import localStorageApi from 'services/localStorageApi';
import 'styles/auth.css'
import Form from './Form';

class Login extends Component {
    formSubmit = values => {
        this.props.isLoading(LOGIN);
        return postPattern('oauth/authorize', values)
            .then(req => req.json())
            .then(
                json => {
                    localStorageApi.setItem('token', json);
                    this.props.isSuccess(LOGIN);
                },
                err => {
                    this.props.isFailure(LOGIN);
                }
            );
    };

    render() {
        return (
            <div className="container-contact100">
                <div className="wrap-contact100">
                    <div className="contact100-form">
                        <div className='tabs flex-row'>
                        <span className="tab contact100-form-title  active">
                            Sign In
                        </span>
                            <Link to="/register" className="tab contact100-form-title">
                                Sign Up
                            </Link>
                        </div>
                        <Form formSubmit={this.formSubmit}/>
                    </div>
                    <div className="contact100-more flex-col-c-m"
                         style={{background: "linear-gradient(120grad, #643986, #98aed5)"}}/>
                </div>
            </div>
        );
    }
}

export default withRouter(connect(null, {isFailure, isLoading, isSuccess})(Login));
