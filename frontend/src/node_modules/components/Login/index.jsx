import React, { Component, Fragment } from 'react';
import { connect } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { SubmissionError } from 'redux-form';

import { LOGIN, isFailure, isLoading, isSuccess } from 'actions';

import { postPattern } from 'services/sendAccount';
import localStorageApi from 'services/localStorageApi';
import 'styles/auth.css'
import Form from './Form';

class Login extends Component {
    formSubmit = values => {
        this.props.isLoading(LOGIN);
        
        return postPattern('/api/obtain-auth-token/', values)
            .then(req => req.json())
            .then(
                json => {
                    localStorageApi.setItem('token', json);
                    this.props.isSuccess(LOGIN);
                },
                err => {
                    this.props.isFailure(LOGIN);
                }
            );
    };
    render() {
        return (
            <Fragment>
                <Form formSubmit={this.formSubmit} />
            </Fragment>
        );
    }
}

export default withRouter(connect(null, { isFailure, isLoading, isSuccess })(Login));
