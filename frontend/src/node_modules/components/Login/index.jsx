import React, { Component, Fragment } from 'react';
import { connect } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { SubmissionError } from 'redux-form';

import {isFailure, isLoading, isSuccess} from 'actions';
import {LOGIN} from 'constants/user'
import {postPattern} from 'services/sendAccount';
import localStorageApi from 'services/localStorageApi';
import Form from './Form';

class Login extends Component {
    formSubmit = values => {
        this.props.isLoading(LOGIN);
        
        return postPattern('/api/obtain-jwt-token/', values)
            .then(
                json => {
                    localStorageApi.setItem('token', json.data.token);
                    this.props.isSuccess(LOGIN);
                    this.props.history.push('/');
                },
                err => {
                    this.props.isFailure(LOGIN);
                }
            );
    };

    render() {
        return (
            <Fragment>
                <Form formSubmit={this.formSubmit} />
            </Fragment>
        );
    }
}

export default withRouter(connect(null, {isFailure, isLoading, isSuccess})(Login));
