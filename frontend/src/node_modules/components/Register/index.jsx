import React, { Component, Fragment } from 'react';
import { connect } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { SubmissionError } from 'redux-form';

import { message } from 'antd';

import { REGISTER, isFailure, isLoading, isSuccess } from '../../actions';
import { postPattern } from 'services/sendAccount';
import Form from './Form';
import 'styles/auth.css'

class Register extends Component {
    formSubmit = values => {
        this.hide = message.loading('Please wait')
        delete values['confirm-password'];
        this.props.isLoading(REGISTER);
        return postPattern('/api/users/', values).then(
            req => {
                this.props.isSuccess(REGISTER);
                message.success('Please check your email!');
                this.props.history.push('/');
            },
            err => {
                this.hide();
                this.props.isFailure(REGISTER);
                message.error('Please check your email!');
                throw new SubmissionError({
                    email: 'Email already exist.',
                    _error: 'Login failed!',
                });
            }
        );
    };
    render() {
        return (
            <Fragment>
                <Form formSubmit={this.formSubmit} />
            </Fragment>
        );
    }
}

export default withRouter(connect(null, { isFailure, isLoading, isSuccess })(Register));
