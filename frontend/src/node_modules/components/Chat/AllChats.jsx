import React, {Component} from 'react'
import {connect} from 'react-redux'
import '../../styles/chat.css'
import {ChatTitle} from './ChatTitle'
import {fetchChats, fetchChatsFailure, fetchChatsSuccess} from "actions";

export class AllChats extends Component {
    constructor(props) {
        super(props);
        this.state = {
            chats: this.props.chats
        };
    }

    componentDidMount() {
        this.props.fetchChats()
    }

    componentWillReceiveProps(prev, next) {
    }


    render() {
        const chats = this.props.chats.map((value, key) => {
            return <ChatTitle key={value.last_message ? value.last_message.created_at : key} chat={value}
                              ChooseChat={this.props.ChooseChat}/>
        });
        return <div className='all-chats'>
            <ul className="chat">
                {chats}
            </ul>
        </div>
    }
}

function mapStateToProps(state) {
    return {chats: state.chat.chats}
}

function mapDispatchToProps(dispatch) {
    return {
        fetchChats: () => {
            const response = dispatch(fetchChats());
            response.payload.then((response) => {
                if (response.error) {
                    return dispatch(fetchChatsFailure(response.error))
                }
                return dispatch(fetchChatsSuccess(response.data))
            })

        }
    }
}

AllChats = connect(mapStateToProps, mapDispatchToProps)(AllChats);
export default AllChats