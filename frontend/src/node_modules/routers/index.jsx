import React from 'react';
import { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';
import { connect } from 'react-redux';
import { PrivateRoute } from './PrivateRoute';
import { 
    Login,
    Register,
    Menu,
    NoMatch,
    AllChats,
    ChatWrapper,
    Chat
} from 'components';
import { LOGIN, isSuccess, isFailure } from 'actions';
import localStorageApi from 'services/localStorageApi';

/*eslint-disable */
class Routes extends React.Component {
    componentDidMount() {
        this.props.setLoggedIn(localStorageApi.getItem());
        console.log('Route did mount!')
    }

    render() {
        console.log(this)
        return (
            <Router>
                <Switch>
                    <Menu isloggedIn={this.props.isLoggedIn}>
                        <PrivateRoute exact path="/" render={() => <h1> You are logedIn! </h1> } />
                        <PrivateRoute
                            path="/logout"
                            render={() => {
                                localStorage.removeItem('token');
                                return <Redirect to="login" />;
                            }}
                        />
                        <Route path="/login" component={Login} />
                        <Route path="/register" component={Register} />
                        <Route path='/chat' component={Chat}/>
                        <Route path='/chat-test' component={AllChats}/>
                        <Route path='/chat-wrapper' component={ChatWrapper}/>
                        <Route path="*" render={() => <NoMatch isloggedIn={this.isLoggedIn} />} />
                    </Menu>
                </Switch>
            </Router>
        );
    }
}

const mapStateToProps = state => (
    {
        isLoggedIn: state.login.isLoggedIn
    }
)

const mapDispatchToProps = dispatch => (
    {
        setLoggedIn: state => state ? dispatch(isSuccess(LOGIN)) : dispatch(isFailure(LOGIN))
    }
)

export default connect(mapStateToProps, mapDispatchToProps)(Routes);
